## 机器人的运动学分析

#### 转弯

对于一个四轮驱动的机器人，当轮子正投影的中心、对应舵机的转轴和横向两个舵机的转轴共线时，有运动学模型如图：

![图1](\Resources\md\Kinematics analysis of robot\Fig1.png)

由四个舵机转轴构成的矩形，设其长为$2h$，宽为$2l$；轮子正投影中心到对应舵机的转轴的距离为$m$。另该机器人沿半径为R的圆弧轨道转弯，则如图：

![图1](\Resources\md\Kinematics analysis of robot\Fig2.png)

外侧前后轮与正前方的夹角大小相等、方向相反。内侧同理。外侧轮轨道、内侧轮轨道、小车质心轨道为三个同心的圆弧。

设外侧轮子与正前方的夹角为$\pm\theta_外$（逆时针为正方向），轨道半径为$R_外$，轮子线速度为$v_外$；内侧轮子与正前方的夹角为$\pm\theta_内$，轨道半径为$R_内$，轮子线速度为$v_内$；转弯角速度为$\omega$。计算可得：
$$
R_外=\sqrt{h^2+(R+l)^2}+m\\
\theta_外=\arctan\frac{h}{R+l}\\
v_外=\omega R_外\\
R_内=\sqrt{h^2+(R-l)^2}-m\\
\theta_内=\arctan\frac{h}{R-l}\\
v_内=\omega R_内
$$
通过以上公式可以实现沿相切圆弧轨道的转弯。

#### 定位

以机器人的初始位置为原点建立平面直角坐标系。机器人任意时刻的方向可由电子罗盘精确得知，故x、y轴正方向可随意选取。

上文所述的运动模型只能实现两种类型的运动：走直线和走圆弧。因此，其每一段直线和圆弧的运动都可以等效为一个二维向量。当轮子的转动引入PID控制后，就可以得知每一段运动中每个轮子的行驶距离。将每一段对应的向量相加，在不考虑误差和干扰的情况下就能得出机器人相对原点的位置。

- 直线运动

  设小车的前进方向与x轴正方向的夹角为$\varphi$（逆时针为正方向），行进距离为$L$，则该段运动的向量为
  $$
  \{L\cos\varphi,L\sin\varphi\}
  $$

- 圆弧运动

  设小车进入圆弧时，前进方向与x轴正方向的夹角为$\varphi$（逆时针为正方向），圆弧半径为$R$，圆弧角为$\theta$（逆时针为正方向），则可将圆弧运动拆分为两步：前进方向先旋转角度$-\varphi$，变为沿x轴正方向，再旋转角度$\varphi+\theta$，完成整个圆弧运动。经计算，该段运动的向量为
  $$
  \{-R[\sin\varphi+\sin(\varphi+\theta)],R[\cos(\varphi+\theta)-\cos\varphi]\}
  $$
  

其中，$\varphi$可由电子罗盘读数，减去x轴正方向对应的角度得知。

$R$是人为规定的值，决定了转弯的性能。$R$越小，转的弯越陡，轮子旋转的角度也越大。

$\theta$可由下式给出：
$$
\theta=\frac{l}{r}
$$
其中$l$是某个轮子行进的距离，$r$是该轮子的轨道半径。

此外，电子罗盘也能为$\theta$校准：
$$
\theta=\varphi-\varphi_0
$$
其中$\varphi$是转弯后的方向与x轴正方向的夹角，$\varphi_0$是转弯前的方向与x轴正方向的夹角。

